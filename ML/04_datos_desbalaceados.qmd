---
title: "Clase 4: Datos desbalanceados"
author: 
- Pamela E. Pairo
- Posgrado Digital Accounting
title-slide-attributes:
    data-background-image: "img/portada.jpg"
format: 
  revealjs:
    theme: [mytheme.scss]
    slide-number: c
    incremental: false
    width: 1600
    height: 1000
    logo: "img/logo.jpg"
    footer: "[Aprendizaje Supervisado- PDA](https://github.com/PamelaPairo/clases_pda)"
    chalkboard:
      theme: whiteboard
      boardmarker-width: 5
      buttons: true
    echo: true
editor: visual
---

## En la clase de hoy...

[**En la primera parte:**]{style="color: #ae260e;"}

. . .

-   Avisos
-   T√©cnicas para el manejo de datos desbalanceados

. . .

[**Recreo**]{style="color: #ae260e;"} `r emo::ji("coffee")`üßâ

. . .

[**En la segunda parte:**]{style="color: #ae260e;"}

. . .

-   Integraci√≥n

##  {background-color="#C5E1A5"}

<h3 style="color:black;background-color: rgba(255,255,255,0.65);padding:5px;line-height:2em; text-align: center; position: absolute; top: 40%; width: 100%;">

[Avisos ‚ú®]{style="font-size: 100px;"}

</h3>

## LatinR 2022 (virtual)

### Tutoriales (10 y 11 de octubre)

- Comunicando seus resultados: Criando apresenta√ß√µes com Quarto.

- Introducci√≥n a RMarkdown, creando reportes con R y Python en RStudio.

- Herramientas y atajos para programar eficientemente con RStudio.

- Introduction to Text Analysis with R.

- Conquistando errores en R.

- Creating Shiny Apps with Rhino: the new framework Shiny apps.

Visitar [la p√°gina del evento](https://latin-r.com/) para mayor informaci√≥n

## GitHub

GitHub es un servicio basado en la nube que aloja un sistema de control de versiones (VCS) llamado [Git]{style="text-decoration: underline;"}.

### ¬øQu√© es el control de versiones?

El [control de versiones]{style="text-decoration: underline;"} es un sistema que ayuda a rastrear y gestionar los cambios realizados en un archivo o conjunto de archivos.

Todo el material de las clases de aprendizaje autom√°tico, se encuentra en el siguiente repositorio

[https://github.com/PamelaPairo/clases_pda](https://github.com/PamelaPairo/clases_pda)

## {background-color="#C5E1A5"}

<h3 style="color:black;background-color: rgba(255,255,255,0.65);padding:5px;line-height:2em; text-align: center; position: absolute; top: 40%; width: 100%;">

[Datos desbalanceadosüìä]{style="font-size: 100px;"}

</h3>

## ¬øQu√© es el desbalance de clases?

> Es un problema recurrente del aprendizaje supervisado en el que una clase supera en gran medida a otra clase. Este problema se enfrenta con m√°s frecuencia en problemas de clasificaci√≥n binaria que en problemas de clasificaci√≥n multiclase

. . .

<h3 style="color:black;padding:5px;line-height:2em; text-align: center; position: absolute; top: 40%; width: 100%;">

El t√©rmino [**desbalance**]{style="color: #88188a;"} se refiere a la disparidad encontrada en la variable dependiente (respuesta).

</h3>

## Algunos Ejemplos

- Las transacciones fraudulentas en un banco.

- Detecci√≥n de un tipo de c√°ncer en los residentes de un √°rea elegida.

- Predecir si los mails son spams o no.

::: columns
::: {.column width="50%"}
![](https://raw.githubusercontent.com/PamelaPairo/Taller_IA/main/clases/images/fraude.jpg){fig-align="center"}
:::

::: {.column width="50%"}
![](https://raw.githubusercontent.com/PamelaPairo/Taller_IA/main/clases/images/spam.jpg){fig-align="center"}
:::
:::

## Algunas formas de lidiar con el desbalance

`r emo::ji("heavy_check_mark")` Cambiar la m√©trica de evaluaci√≥n

. . .

`r emo::ji("heavy_check_mark")` Cambiar el algoritmo

. . .

`r emo::ji("heavy_check_mark")` Sobremuestrear la clase minoritaria

. . .

`r emo::ji("heavy_check_mark")` Submuestrear la clase mayoritaria

. . .

`r emo::ji("heavy_check_mark")` Generaci√≥n de muestras sint√©ticas

## Cambiar la m√©trica de evaluaci√≥n

[**Accuracy**]{style="color: #88188a;"} no es la m√©trica adecuada cuando se tiene un dataset desbalanceado.

En su lugar, es mejor utilizar m√©tricas que tengan m√°s en cuenta los datos de las clases minoritarias como son la f1, la sensitividad o la precisi√≥n.

- [**Matriz de confusi√≥n**]{style="color: #88188a;"}

- [**Precision**]{style="color: #88188a;"}: el n√∫mero de verdaderos positivos (TP) dividido por todas las predicciones positivas (TP+ FP). La baja precisi√≥n indica un alto n√∫mero de falsos positivos.

- [**Recall o Sensibilidad**]{style="color: #88188a;"}: el n√∫mero de verdaderos positivos (TP) dividido por el n√∫mero de valores positivos en los datos de la prueba (TP+ FN). Se la denomina tambi√©n Tasa de verdaderos positivos. Valores bajos indican una gran cantidad de falsos negativos.

- [**F1**]{style="color: #88188a;"}: el promedio ponderado de [**Precision**]{style="color: #88188a;"} y [**Recall**]{style="color: #88188a;"}

## Cambiar el algoritmo


> Es una buena pr√°ctica probar varios algoritmos en nuestro problema de clasificaci√≥n con desbalanceo de datos.

## Sobremuestrear la clase minoritaria

> El sobremuestreo se puede definir como agregar m√°s copias de la clase minoritaria. 
Puede ser una buena opci√≥n cuando no se tiene una gran cantidad de datos con los que trabajar.

## Submuestrear la clase mayoritaria

> El submuestreo se puede definir como eliminar algunas observaciones de la clase mayoritaria. 
Puede ser una buena opci√≥n cuando se tiene una cantidad grande de datos (ej. millones de datos). 

[**Desventaja**]{style="color: #88188a;"} : se est√° eliminando informaci√≥n que puede ser valiosa. Esto podr√≠a dar lugar a un ajuste inadecuado y una mala generalizaci√≥n del conjunto de testeo.

## Generaci√≥n de muestras sint√©ticas

SMOTE or Synthetic Minority Oversampling Technique

SMOTE usa un algoritmo de vecinos m√°s cercanos (KNN) para generar datos nuevos y sint√©ticos que podemos usar para entrenar nuestro modelo.

Se genera un conjunto aleatorio de observaciones de la clases minoritaria para cambiar el sesgo de aprendizaje del clasificador hacia la clase minoritaria.

## Tener en cuenta

- En `R`, necesitamos instalar el siguiente paquete

```r
install.packages("themis")
library(tidymodels)
library(themis)
```

- Hacer el split de los datos **ANTES** de probar t√©cnicas de sobremuestreo submuestreo.

Si se hace lo contrario, puede ocurrir que los mismos datos est√©n presentes tanto en el conjunto de entrenamiento como en el conjunto de testeo (_data leakage_), causando el _overfitting_ y la baja generalizaci√≥n del modelo.

## Referencias

- [Art√≠culo de Towards to Data Science](https://towardsdatascience.com/methods-for-dealing-with-imbalanced-data-5b761be45a18)

- [Tratamiento de clases desbalanceadas](https://machinelearningparatodos.com/tratamiento-de-clases-desbalanceadas/)

- [Practical Guide to deal with Imbalanced Classification Problems in R](https://www.analyticsvidhya.com/blog/2016/03/practical-guide-deal-imbalanced-classification-problems/)

- [Themis](https://themis.tidymodels.org/)
